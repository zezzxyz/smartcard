<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Review Abha</title>
    {% load static %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

    <style>
        body {
            font-family: Lucida Sans Unicode;
    background-color: #f8f9fa;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

/* Navigation Bar Styles */
.navbar {
    background: #000000; /* Dark background for navbar */
    border-bottom: 2px solid #9f22ec; /* Bright border for visual separation */
    padding: 10px 20px; /* Padding for spacing */
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.navbar-brand {
    color: #ecf0f1; /* Light text color for brand */
    font-size: 24px; /* Larger font size for brand name */
    font-weight: bold; /* Bold text for brand name */
}

.navbar-nav .nav-link {
    color: #ffffff; /* White text color for nav links */
    padding: 8px 16px; /* Padding for nav links */
    font-size: 16px; /* Font size for nav links */
    font-weight: 500; /* Medium weight for nav links */
    transition: color 0.3s ease; /* Smooth transition for color change */
}

.navbar-nav .nav-link:hover {
    color: #7b12f3; /* Change text color on hover */
    background: rgba(0, 0, 0, 0.1); /* Light background color on hover */
    border-radius: 1px; /* Rounded corners on hover */
    display: flex;
}

/* Mobile Responsive Navigation */
@media (max-width: 767px) {
    .navbar-nav {
        text-align: center; /* Center align nav links on small screens */
    }

    .navbar-nav .nav-link {
        display: block; /* Display links as block on small screens */
        margin: 5px 0; /* Margin for spacing */
    }
}


.controls-container {
    padding: 5px;
    background-color: #ffffff;
    border-bottom: 1px solid #ddd;
    text-align: center;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
}

.controls-container .button, .controls-container .button-secondary {
    background: linear-gradient(145deg, #6e8efb, #a777e3);
    border: none;
    border-radius: 10px; /* Smaller border radius for a more modern look */
    color: #fff;
    font-size: 12px; /* Smaller font size */
    font-weight: bold;
    padding: 8px 16px; /* Reduced padding for compactness */
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
}

.controls-container .button:hover, .controls-container .button-secondary:hover {
    background: linear-gradient(145deg, #4a5f99, #8a5cbf);
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.2);
}

.controls-container .button:active, .controls-container .button-secondary:active {
    background: linear-gradient(145deg, #4a5f99, #8a5cbf);
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.2);
}

.controls-container .button-secondary {
    background: linear-gradient(145deg, #e94e77, #e84a7a);
    border: none;
    border-radius: 12px;
    padding: 12px 24px;
    transition: all 0.3s ease;
}

.controls-container .button-secondary:hover {
    background: linear-gradient(145deg, #d8406f, #e7486e);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

.controls-container .button-secondary:active {
    background: linear-gradient(145deg, #c6365c, #d5436d);
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.2);
}

/* Button Styles */
.button {
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, box-shadow 0.3s;
    font-family: 'Arial', sans-serif;
    font-size: 14px;
    font-weight: bold;
}

.button-primary {
    background-color: #007bff;
    color: #fff;
}

.button-primary:hover {
    background-color: #0056b3;
}

.button-success {
    background-color: #28a745;
    color: #fff;
}

.button-success:hover {
    background-color: #218838;
}




/* Custom Checkbox Styles */
.custom-checkbox {
    position: relative;
    display: inline-block;
    cursor: pointer;
    font-size: 16px;
    user-select: none;
}

.custom-checkbox input {
    opacity: 0;
    position: absolute;
    cursor: pointer;
    height: 0;
    width: 0;
}

.custom-checkbox .checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 20px;
    width: 20px;
    background-color: #eee;
    border-radius: 4px;
    transition: background-color 0.3s ease;
}

.custom-checkbox input:checked ~ .checkmark {
    background-color: #007bff;
}

.custom-checkbox .checkmark:after {
    content: "";
    position: absolute;
    display: none;
}

.custom-checkbox input:checked ~ .checkmark:after {
    display: block;
    left: 6px;
    top: 2px;
    width: 8px;
    height: 14px;
    border: solid white;
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
}




.main-content {
    flex: 1;
    padding: 20px;
}

h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
}

.table {
    max-width: 800px;
    margin: 0 auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.id-card-wrapper {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 0px;
    margin-top: 0px;
    position: relative;
    transform: scale(1); /* Apply default 1.8x zoom */
    transform-origin: center center;
    transition: transform 0.2s ease;
}

.id-card-container {
    width: 89.60mm; /* Set width to CR80 size */
    height: 55.98mm; /* Set height to CR80 size */
    /*width: 320px;  Increased size for better visibility */
    /*height: 210px;  Increased size for better visibility */
    background-size: cover;
    background-position: center;
    position: relative;
    border: 1px solid #ccc;
    border-radius: 15px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    cursor: grab;
    background-image: none;
    transition: transform 0.2s, box-shadow 0.2s;
    
}

.id-card-container:active {
    cursor: grabbing;
}

.id-card-container.no-background {
    background-image: none;
}

.id-card-front {
    background-image: url("{% static 'images/abha1.jpg' %}");
}

.id-card-back {
    background-image: url("{% static 'images/abha2.jpg' %}");
}

.id-card-content {
    position: absolute;
    top: 65px;
    left: 80px;
    color: #333;
    font-size: 8px;
    border-radius: 0px;
    padding: 1px;
    width: 160px;
    /*box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);*/
}

.id-card-content2 {
    position: absolute;
    bottom: 10px;  /* Position the section near the bottom */
    left: 5px;
    right: 5px;
    color: #333;
    font-size: 8px;
    display: flex;
    justify-content: space-between;  /* Distribute items evenly */
    align-items: center;
    padding: 5px;
    width: calc(100% - 10px);  /* Full width minus padding */
}

.info-box {
    flex: 1;
    text-align: center;  /* Center the text in each box */
    padding: 0 5px;  /* Add some space between the content */
}


.red-bordered-box {
    position: absolute;
    border: 1px solid rgba(0, 0, 0, 0.579); /* Red border */
    top: 110px;
    left: 100px;
    font-size: 5.6px; /* Matching text styling */
    padding: 2px;
    width: 215px;
}

.vertical-text {
    position: absolute;
    bottom: 50px;
    left: 20px;
    transform: rotate(-90deg);
    transform-origin: bottom left;
    font-size: 6px;
    font-weight: bold;
    color: #333;
    white-space: nowrap;
    text-align: center;
    padding-bottom: 12px;
}

.vertical-text-back {
    position: absolute;
    bottom: 50px;
    left: 20px;
    transform: rotate(-90deg);
    transform-origin: bottom left;
    font-size: 6px;
    font-weight: bold;
    color: #333;
    white-space: nowrap;
    text-align: center;
    padding-bottom: 12px;
}

.profile-photo {
    position: absolute;
    top: 68px;
    left: 10px;
    width: 58px;
    height: 70px;
    border: 1px solid #000000; /* White border around the photo */
    border-radius: 2px;
    filter: brightness(1) contrast(1) grayscale(0);
    transition: filter 0.3s ease;
}

.profile-photo-controls {
    margin-top: 20px;
    text-align: center;
}

.profile-photo-controls label {
    display: block;
    margin: 10px 0;
    font-size: 14px;
}

.profile-photo-controls input[type="range"] {
    width: 200px;
}


.qr-code {
    position: absolute;
    top: 56px;
    right: 10px;
    width: 100px;
    height: 100px;
}

.signature {
    position: absolute;
    top: 170px;
    left: 110px;
    width: 80px;
    height: 22px;
}

.card-number-front, .card-number-back {
    font-size: 12px;
    font-weight: bold;
}

.card-number-front {
    position: absolute;
    right: 140px;
    bottom: 110px;
}
.card-slogan-front {
    position: absolute;
    right: 82px;
    top: 191px;
    font-size: 15px;
    font-weight: bold; /* Makes the font bold */
    font-stretch: expanded; /* Stretches the font horizontally */
    letter-spacing: 1px; /* Increases space between letters */
}

.card-number-back {
    position: absolute;
    right: 50%;
    bottom: 15px;
    transform: translateX(50%);
    color: #333;
    text-align: center;
}

.card-number-text {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 0;
}

.vid {
    font-size: 12px;
    color: #333;
    border-top: 1px dotted #333;
    margin-top: 0;
    padding-top: 0;
}

.address {
    position: absolute;
    top: 44px;
    left: 5px;
    color: #333;
    font-size: 7.5px;
    border-radius: 5px;
    padding: 8px;
    width: 235px;
    /*background: rgba(255, 255, 255, 0.7);*/
    /*box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);*/
}

.zoom-container {
    overflow: hidden;
    width: 100%;
    height: 55%;
    border: 2px solid hsl(212, 72%, 59%); /* Sleek, modern border color */
    padding: 5px;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(0, 0, 0, 0.3)); /* Gradient background */
    border-radius: 20px; /* Smooth rounded corners */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3), inset 0 2px 5px rgba(255, 255, 255, 0.1); /* Dual shadow effect */
    backdrop-filter: blur(20px); /* Enhanced glass effect */
    transition: background 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease; /* Smooth transitions */
}





/* Popup Container */
.popup-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 22vw; /* Further reduced width */
    max-width: 320px;
    height: auto;
    background: linear-gradient(135deg, #1a1a1a, #262626);
    border-radius: 12px;
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.8);
    display: flex;
    overflow: hidden;
    z-index: 1000;
    animation: futuristicSlideIn 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

/* Popup Header */
.popup-header {
    background: #1f1f1f;
    color: #e0e0e0;
    padding: 6px;
    font-size: 14px;
    font-weight: bold;
    text-align: center;
    border-bottom: 1px solid #333;
}

/* Popup Content */
.popup-content {
    display: flex;
    padding: 5px;
    gap: 2px;
}

/* Profile Photo Section */
.profile-photo-section {
    flex: 0 0 90px; /* Reduced profile photo section */
    display: flex;
    justify-content: center;
    align-items: center;
    background: #141414;
    padding: 2%;
    border-radius: 8px;
    box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.4);
}

.profile-photo-section img {
    max-width: 120%;
    max-height: 100px; /* Slightly smaller photo */
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

/* Controls Section */
.controls-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 2px; /* Reduced gap between controls */
    padding: 0 2px;
    background: #202020;
    border-radius: 8px;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
}

.controls-section label {
    color: #b0b0b0;
    font-size: 10px;
    font-weight: 600;
    margin-bottom: 2px; /* Reduced margin for compactness */
}

.controls-section input[type="range"] {
    width: 100%;
    cursor: pointer;
    -webkit-appearance: none;
    background: #3a3a3a;
    border-radius: 8px;
    height: 8px;
    outline: none;
    transition: background 0.3s ease;
}

.controls-section input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    background: #50e3c2;
    border-radius: 50%;
    width: 14px;
    height: 14px;
    cursor: pointer;
}

.controls-section input[type="range"]::-moz-range-thumb {
    background: #50e3c2;
    border-radius: 50%;
    width: 14px;
    height: 14px;
    cursor: pointer;
}

.controls-section input[type="range"]:hover {
    background: #4c4c4c;
}

/* Buttons */
.popup-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 8px; /* Reduced margin for compactness */
}

.popup-buttons .button {
    border: none;
    padding: 6px 12px; /* Compact buttons */
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(135deg, #6e8efb, #a777e3);
    transition: background 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
}

.popup-buttons .button:hover {
    background: linear-gradient(135deg, #5a6fc1, #9e6fd0);
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.4);
}

.popup-buttons .button:active {
    background: linear-gradient(135deg, #4a5f99, #8a5cbf);
    box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.3);
}

/* Close Button */
.close-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    background: #e94e77;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
    transition: background 0.3s ease;
}

.close-btn:hover {
    background: #d8406f;
}

.close-btn:focus {
    outline: none;
}

/* Animation for popup */
@keyframes futuristicSlideIn {
    0% {
        opacity: 0;
        transform: translate(-50%, -40%) scale(0.7) rotate(-10deg);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .popup-container {
        width: 75vw;
        max-width: 280px;
    }

    .profile-photo-section {
        flex: 0 0 80px;
    }

    .profile-photo-section img {
        max-height: 70px;
    }
}



/* End Popup css */


@media screen {
    .id-card-container {
        transform: scale(1); /* Apply 2x zoom */
        transform-origin: top left; /* Ensure the zoom starts from the top-left corner */
    }
}


.padding-id {
    padding: 20px; /* Adjust padding as needed */
}



@media print {
    @page {
        size: 85.60mm 53.98mm; /* CR80 size */
        margin: 0 !important; /* Ensure no margins */
    }

    html, body {
        margin: 0; /* Ensure no margins on html and body */
        padding: 0; /* Ensure no padding on html and body */
        height: 100%; /* Ensure full height */
    }

    body * {
        visibility: hidden;
        margin: 0;
    }

    .navbar, .controls-container, .navigation {
        display: none; /* Hide navbar and controls container */
    }

    .id-card-container, .id-card-container * {
        visibility: visible; /* Show only the ID card */
        box-sizing: border-box; /* Ensure that padding/borders are included in size */
    }

    .padding-id {
        display: none; /* Hide padding during print */
    }

    .id-card-wrapper {
        visibility: visible;
        page-break-inside: avoid; 
        width: 95.5mm; /* Set width to CR80 size */
        height: 58.8mm; /* Set height to CR80 size */
        padding: 0px !important;
        margin: 0;
        padding-left: 0px;
        padding-top: 0px;
        position: relative;
        zoom: 1.35; /* Adjust the zoom to fit content */ 
        box-sizing: border-box; /* Ensure no extra padding is added */
        margin-top: -14px; /* Cut 10px from the left side */
        margin-left: -14px;
        
    }

    .id-card-container {
        position: relative;
        left: 0;
        top: 0;
        width: 100%; /* Adjust width to fit within the page */
        height: 100%; /* Adjust height to fit within the page */
        display: block;
        background-size: cover;
        background-position: center;
        border-radius: 0;
        border: none;
        margin: 0 !important; /* Remove margins */
        padding: 0 !important; /* Remove padding */
        box-shadow: none !important;
        box-sizing: border-box; /* Include borders/padding in width/height */
    }

    .id-card-content, .profile-photo, .qr-code {
        max-width: 100%;
        max-height: 100%;
        margin: 0;
        overflow: hidden;
        box-sizing: border-box; /* Include padding in width/height */
    }

    .id-card-front {
        background-image: url("{% static 'images/abha1.jpg' %}"); /* Ensure the path is correct */
        margin: 0 !important; /* Remove margins */
        padding: 0px !important; /* Remove padding */
        visibility: visible;
        page-break-after: always; /* Ensure the front card is on a separate page */
    }

    .id-card-back {
        background-image: url("{% static 'images/abha2.jpg' %}"); /* Ensure the path is correct */
        margin: 0;
        padding: 0px !important; /* Remove padding */
        visibility: visible;
        page-break-before: always; /* Start a new page before the back side */
        
    }

    .print-front .id-card-back {
        display: none;
    }

    .print-back .id-card-front {
        display: none;
        page-break-after: auto; /* Ensure page break doesn't apply when printing only the back */
    }
}


        #cropped-image {
            margin-top: 20px;
            
        }

        canvas {
            display: none; /* Hide the canvas */
        }



/* General container for small dropdown */
#genderSelect {
    width: 120px; /* Adjust the width to fit the small size */
    height: 30px; /* Reduce the height */
    font-size: 12px; /* Small font size */
    padding: 2px 5px; /* Smaller padding for a compact look */
    border-radius: 5px; /* Slightly rounded corners */
    border: 1px solid #ccc; /* Light border */
    background-color: #f8f9fa; /* Light background */
    color: #333; /* Text color */
    outline: none;
}

/* Hover and Focus State */
#genderSelect:hover, #genderSelect:focus {
    border-color: #007bff; /* Change border color on hover/focus */
    background-color: #e9ecef; /* Slightly darker background on hover/focus */
    color: #007bff; /* Change text color */
    cursor: pointer;
}

/* For a very small dropdown */
#genderSelect.small {
    width: 100px; /* Even smaller width */
    height: 25px; /* Smaller height */
    font-size: 10px; /* Smaller font size */
    padding: 1px 3px; /* Tighter padding */
}

/* Optional styling for label */
label[for="genderSelect"] {
    font-size: 12px; /* Small font size for the label */
    margin-right: 5px;
}



/* Flexbox container to align content centrally */
.center-container {
    display: flex;
    flex-direction: column; /* Stack label and dropdown vertically */
    align-items: center; /* Center horizontally */
    justify-content: center; /* Center vertically if required */
    padding-right: 500px;
    
}

/* Keep dropdown styling small and minimal */
#genderSelect {
    width: 120px;
    height: 30px;
    font-size: 12px;
    padding: 2px 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
    background-color: #f8f9fa;
    color: #333;
    outline: none;
    text-align: center; /* Center text inside dropdown */
}

/* Smaller version of dropdown */
#genderSelect.small {
    width: 100px;
    height: 25px;
    font-size: 10px;
    padding: 1px 3px;
}

/* Label styling */
label[for="genderSelect"] {
    font-size: 12px;
    margin-bottom: 5px; /* Space between label and dropdown */
    color: #333;
}




.custom-file-upload {
    display: inline-block;
    padding: 2px 4px;
    cursor: pointer;
    background-color: #6d26b0; /* success color */
    color: white;
    border-radius: 5px;
}

#file-input {
    display: none; /* Hide the actual file input */
}

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Abha</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'dashboard' %}">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'wallet' %}">Wallet</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'id_card_input' %}">Create ID Card</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'id_card_output' %}">View ID Cards</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'account_logout' %}">Signout</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="controls-container">
        <!-- Existing controls -->
    


        <a href="{% url 'upload_abha' %}" class="button button-success" >Back</a>
        <div class="toggle-background">
            <label class="custom-checkbox">
                <input type="checkbox" class="form-check-input" id="toggleBackground">
                <span class="checkmark"></span> &nbsp; &nbsp; &nbsp; View Full
            </label>
        </div>
        <label for="file-input" class="custom-file-upload">
            <input type="file"  class="button button-success" id="file-input" accept="application/pdf" />
            Upload PDF
        </label>
        <div>
            <button class="button button-primary" onclick="openProfileControls()">Adjust Profile</button>
        </div>
        
        <select id="printOption" class="small">
                
            <option value="front">Front Page </option>
            <option value="back">Back Page </option>
            <option value="both">Both Pages </option>
            
        </select>

        <div>

            

            <button class="button button-success" onclick="printIDCard()">Print ID Card</button>
            
            

           
        </div>
    


        <!-- Profile Picture Controls -->
        
    </div>
    
    <!-- Profile Picture Control Popup -->
 <!-- Popup Structure -->
<div id="profileControlsPopup" class="popup-container" style="display: none;">
    <button class="close-btn" onclick="closeProfileControls()">×</button>
    <div class="popup-header">Adjust Profile Photo</div>
    <div class="popup-content">
        <!-- Profile Photo Section -->
        <div class="profile-photo-section">
            <img id="profileImagePreview" src="" alt="Profile Photo Preview">
        </div>
        
        <!-- Controls Section -->
        <div class="controls-section">
            <div class="control-group">
                <label for="brightness">Brightness</label>
                <input type="range" id="brightness" min="0" max="200" step="1" value="100" oninput="updatePreview()">
            </div>
            <div class="control-group">
                <label for="contrast">Contrast</label>
                <input type="range" id="contrast" min="0" max="200" step="1" value="100" oninput="updatePreview()">
            </div>
            <div class="control-group">
                <label for="saturation">Saturation</label>
                <input type="range" id="saturation" min="0" max="200" step="1" value="100" oninput="updatePreview()">
            </div>
            <div class="control-group">
                <label for="blur">Blur</label>
                <input type="range" id="blur" min="0" max="10" step="0.1" value="0" oninput="updatePreview()">
            </div>
            <div class="popup-buttons">
                <button class="button" onclick="applyAdjustments()">Apply</button>
                <button class="button" onclick="resetAdjustments()">Reset</button>
            </div>
        </div>
    </div>
</div>

    <div class="main-content">

            <div class="padding-id">

            </div>
            <div class="id-card-wrapper">
                <div class="id-card-container id-card-front" id="idCardFront">
                   
                    {% if data.profile_photo %}
                    <img class="profile-photo" id="mainProfilePhoto" src="data:image/png;base64,{{ data.profile_photo }}" alt="Profile Photo"/>
                    {% endif %}
                    <div class="id-card-content">
                        <div><b>Name / नाम <br>{{ data.name }}</b></div>
                        <div style="padding-top: 8px;">
                            <b> Abha Number / आभा संख्या<br>
                            {{ data.abha_number }}</b></div>
                        <div style="padding-top: 8px; ">
                            <b>Abha Address / आभा पत्ता<br>
                                {{ data.abha_address }}</b></div>
                        
                    </div>

                    <div class="id-card-content2">
                        <div class="info-box"><b>Gender&nbsp;/&nbsp;लिंग </b> <br><b id="genderDisplay">{{ data.gender }}</b></div>
                        <div class="info-box"><b>Date&nbsp;of&nbsp;Birth&nbsp;/&nbsp;जन्मतारीख </b><br><b>{{ data.dob }}</b></div>
                        <div class="info-box"><b>Mobile&nbsp;/&nbsp;मोबाईल </b><br><b>{{ data.mobile }}</b></div>
                    </div>
                    

                    <canvas id="canvas" ></canvas>
                    <div style="padding-left: 225px; padding-top: 40px;">
                        <img id="cropped-image" alt="" />
                    </div>

                    {% if data.qr_code_image %}
                    <img class="qr-code" src="data:image/png;base64,{{ data.qr_code_image }}" alt="QR Code" />
                    {% endif %}
                    <div class="card-number-front">{{ data.card_number }} </div>

                    {% if data.signature_or_thumbprint %}
                    <img class="signature" src="data:image/png;base64,{{ data.signature_or_thumbprint }}" alt="Signature" />
                    {% endif %}
                    
                </div>

                <div class="id-card-container id-card-back" id="idCardBack">
                    
                    
                </div>
            </div>

             <div class="center-container">   
        <select id="genderSelect" class="form-control small">
            <option value="">Select Gender</option>
            <option value="male/पुरुष">Male / पुरुष</option>
            <option value="female/स्त्री">Female / स्त्री</option>
        </select>
    </div>

        
        <div class="navigation" style="padding-top: 250px;">
            <form method="POST" action="{% url 'save_id_card' %}">
                {% csrf_token %}
                <table class="table table-bordered">
                    <tr>
                        <th>Name:</th>
                        <td>{{ data.name }}
                            <br>
                            {{ data.hindi_name }}
                    
                        </td>
                    </tr>
                    

                   

                    <tr>
                        <th>Gender:</th>
                        <td>{{ data.gender }}</td>
                    </tr>
                    <tr>
                        <th>Qr Code:</th>
                        <td>{{ data.qr_code_image }}</td>
                    </tr>


                    
                    <!-- Add more fields as necessary -->
                </table>
                <button type="submit" class="btn btn-primary">Save</button>
            </form>
        </div>


    </div>

    <script>
document.getElementById('toggleBackground').addEventListener('change', function () {
    const cards = document.querySelectorAll('.id-card-container');
    if (this.checked) {
        cards.forEach(card => card.classList.remove('no-background'));
    } else {
        cards.forEach(card => card.classList.add('no-background'));
    }
});

// Initialize background visibility based on checkbox state on page load
document.addEventListener('DOMContentLoaded', function () {
    const checkbox = document.getElementById('toggleBackground');
    const cards = document.querySelectorAll('.id-card-container');
    if (checkbox.checked) {
        cards.forEach(card => card.classList.remove('no-background'));
    } else {
        cards.forEach(card => card.classList.add('no-background'));
    }
});







function openProfileControls() {
    const profileImg = document.getElementById('mainProfilePhoto');
    const profileImagePreview = document.getElementById('profileImagePreview');

    // Set the source of the profile image preview
    profileImagePreview.src = profileImg.src;
    updatePreview(); // Initialize preview with current settings

    // Display the popup
    document.getElementById('profileControlsPopup').style.display = 'block';
}

function closeProfileControls() {
    document.getElementById('profileControlsPopup').style.display = 'none';
}

function updatePreview() {
    const brightness = document.getElementById('brightness').value;
    const contrast = document.getElementById('contrast').value;
    const saturation = document.getElementById('saturation').value;
    const blur = document.getElementById('blur').value;
    const profileImagePreview = document.getElementById('profileImagePreview');

    // Apply the filters to the preview image
    profileImagePreview.style.filter = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturation}%) blur(${blur}px)`;
}

function applyAdjustments() {
    const brightness = document.getElementById('brightness').value;
    const contrast = document.getElementById('contrast').value;
    const saturation = document.getElementById('saturation').value;
    const blur = document.getElementById('blur').value;
    const profileImg = document.getElementById('mainProfilePhoto');

    // Apply the filters to the original profile image
    profileImg.style.filter = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturation}%) blur(${blur}px)`;
    closeProfileControls(); // Close the popup after applying adjustments
}

function resetAdjustments() {
    document.getElementById('brightness').value = 100;
    document.getElementById('contrast').value = 100;
    document.getElementById('saturation').value = 100;
    document.getElementById('blur').value = 0;

    updatePreview();
}

// Close the modal if the user clicks outside of it
window.onclick = function(event) {
    if (event.target == document.getElementById('profileControlsPopup')) {
        closeProfileControls();
    }
}

function printIDCard() {
    const printOption = document.getElementById("printOption").value;
    const showBackground = document.getElementById("toggleBackground").checked;

    if (printOption === "front") {
        printFront(showBackground);
    } else if (printOption === "back") {
        printBack(showBackground);
    } else if (printOption === "both") {
        printBoth(showBackground);
    }
}

function printFront(showBackground) {
    const front = document.getElementById("idCardFront");
    const back = document.getElementById("idCardBack");

    // Hide the back side and apply print CSS
    back.style.display = 'none';
    front.style.display = 'block';
    document.body.classList.add('print-front-page');

    // Toggle background visibility
    if (showBackground) {
        front.classList.remove('no-background');
    } else {
        front.classList.add('no-background');
    }

    // Trigger print
    window.print();

    // Restore original state
    back.style.display = 'block';
    document.body.classList.remove('print-front-page');
}

function printBack(showBackground) {
    const front = document.getElementById("idCardFront");
    const back = document.getElementById("idCardBack");

    // Hide the front side and apply print CSS
    front.style.display = 'none';
    back.style.display = 'block';
    document.body.classList.add('print-back-page');

    // Toggle background visibility
    if (showBackground) {
        back.classList.remove('no-background');
    } else {
        back.classList.add('no-background');
    }

    // Trigger print
    window.print();

    // Restore original state
    front.style.display = 'block';
    document.body.classList.remove('print-back-page');
}

function printBoth(showBackground) {
    const front = document.getElementById("idCardFront");
    const back = document.getElementById("idCardBack");

    // Ensure both sides are visible and apply print CSS
    front.style.display = 'block';
    back.style.display = 'block';
    document.body.classList.add('print-both-pages');

    // Toggle background visibility
    if (showBackground) {
        front.classList.remove('no-background');
        back.classList.remove('no-background');
    } else {
        front.classList.add('no-background');
        back.classList.add('no-background');
    }

    // Trigger print, first page (front) will be printed, then the second (back)
    window.print();

    // Restore original state
    document.body.classList.remove('print-both-pages');
}



function printIDCardVirtual() {
    const printOption = document.getElementById("printOption").value;
    const showBackground = document.getElementById("toggleBackground").checked;

    if (printOption === "front") {
        generateImageAndPrint("idCardFront", showBackground);
    } else if (printOption === "back") {
        generateImageAndPrint("idCardBack", showBackground);
    } else if (printOption === "both") {
        generateImageAndPrintBoth(showBackground);
    }
}

function generateImageAndPrint(elementId, showBackground) {
    const element = document.getElementById(elementId);

    // Toggle background visibility
    if (showBackground) {
        element.classList.remove('no-background');
    } else {
        element.classList.add('no-background');
    }

    // Convert the element to an image
    html2canvas(element).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const imgWindow = window.open('', '_blank');
        imgWindow.document.write('<img src="' + imgData + '" onload="window.print(); window.close();" />');
        imgWindow.document.close();
    });
}

function generateImageAndPrintBoth(showBackground) {
    const front = document.getElementById("idCardFront");
    const back = document.getElementById("idCardBack");

    // Toggle background visibility for both sides
    if (showBackground) {
        front.classList.remove('no-background');
        back.classList.remove('no-background');
    } else {
        front.classList.add('no-background');
        back.classList.add('no-background');
    }

    // Convert both sides to images and print them
    html2canvas(front).then(frontCanvas => {
        const frontImgData = frontCanvas.toDataURL('image/png');
        html2canvas(back).then(backCanvas => {
            const backImgData = backCanvas.toDataURL('image/png');

            const imgWindow = window.open('', '_blank');
            imgWindow.document.write(`
                <img src="${frontImgData}" onload="window.print();" />
                <img src="${backImgData}" onload="window.print(); window.close();" />
            `);
            imgWindow.document.close();
        });
    });
}



</script>

<!-- automatically crop image here -->
<script>
    const fileInput = document.getElementById('file-input');
    const croppedImage = document.getElementById('cropped-image');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let pdfDoc = null;
    let pageNum = 1;

    fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file && file.type === 'application/pdf') {
            const fileReader = new FileReader();
            fileReader.onload = function () {
                const pdfData = new Uint8Array(this.result);
                pdfjsLib.getDocument(pdfData).promise.then((doc) => {
                    pdfDoc = doc;
                    autoCropPDF();
                }).catch(error => {
                    console.error("Error loading PDF: ", error);
                });
            };
            fileReader.readAsArrayBuffer(file);
        } else {
            alert("Please upload a valid PDF file.");
        }
    });

    function autoCropPDF() {
        pdfDoc.getPage(pageNum).then((page) => {
            const viewport = page.getViewport({ scale: 2 }); // Increase scale for better resolution
            canvas.width = viewport.width;
            canvas.height = viewport.height;

            const renderContext = {
                canvasContext: ctx,
                viewport: viewport,
            };

            page.render(renderContext).promise.then(() => {
                // Specify the cropping area (x, y, width, height)
                const cropX = 704; // X coordinate of the crop area
                const cropY = 180; // Y coordinate of the crop area
                const cropWidth = 180; // Width of the crop area
                const cropHeight = 180; // Height of the crop area

                // Create a new off-screen canvas for cropping
                const cropCanvas = document.createElement('canvas');
                cropCanvas.width = cropWidth / 1.8; // size divide
                cropCanvas.height = cropHeight / 1.8; // Reduce height 
                const cropCtx = cropCanvas.getContext('2d');

                // Draw the cropped area on the crop canvas at half size
                cropCtx.drawImage(canvas, cropX, cropY, cropWidth, cropHeight, 0, 0, cropCanvas.width, cropCanvas.height);

                // Convert the crop canvas to an image and display it
                const dataUrl = cropCanvas.toDataURL();
                if (dataUrl) {
                    croppedImage.src = dataUrl;
                    croppedImage.style.display = "block"; // Show the cropped image
                } else {
                    console.error("Failed to generate image data URL.");
                }
            }).catch(error => {
                console.error("Error rendering PDF page: ", error);
            });
        }).catch(error => {
            console.error("Error processing PDF page: ", error);
        });
    }
</script>



<script>
    document.getElementById('genderSelect').addEventListener('change', function() {
        const selectedGender = this.value.charAt(0).toUpperCase() + this.value.slice(1);  // Capitalize first letter
        document.getElementById('genderDisplay').textContent = selectedGender;
    });
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>



